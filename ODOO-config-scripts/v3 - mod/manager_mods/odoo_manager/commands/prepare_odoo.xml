<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="command_gitpull" model="access_server.command">
        <field name="name">Git pull a repository branch</field>
        <field name="bash_code">
pushd %(MAIN_GIT_LOCAL_REPO)s
echo "== Checking out %(BRANCH_NAME)s branch:"
git checkout %(BRANCH_NAME)s
echo "== Pulling from origin:"
git pull
popd
        </field>
    </record>

    <record id="call_gitpull" model="access_server.command.call">
        <field name="base_command" ref="command_gitpull" />
        <field name="arguments_ids" eval="[
                (5, 0, 0),
                (0, 0, { 'key': 'MAIN_GIT_LOCAL_REPO', 'value': '/odoo/odoo-full-git/',  }),
                (0, 0, { 'key': 'BRANCH_NAME', 'value': '12.0',  }),
                ]" />
    </record>

    <record id="command_newconfig" model="access_server.command">
        <field name="name">Create new config for giver Odoo instance</field>
        <field name="bash_code">
export DB_PASSWORD=`python3 -c 'with open("/odoo/odooconfig.conf") as f: exec(f.read()); print(CONFIG["DB_PASSWORD"])'`

# Install the config file:
cat &lt;&lt; EOF &gt; /odoo/configs/%(INSTANCENAME)s.conf
[options]
addons_path = %(BRANCHPATH)s/addons
#admin_passwd =
csv_internal_sep = ,
data_dir = /odoo/.local/share/Odoo
db_host = localhost
db_maxconn = 64
db_name = %(INSTANCENAME)s
db_port = 5432
db_sslmode = prefer
db_template = template1
db_user = %(ODOO_USERNAME)s
db_password = $DB_PASSWORD
demo = {}
email_from = False
;geoip_database = /usr/share/GeoIP/GeoLite2-City.mmdb
http_enable = True
http_interface = 0.0.0.0
http_port = %(HTTPPORT)s
import_partial = 
limit_memory_hard = 2684354560
limit_memory_soft = 2147483648
limit_request = 8192
limit_time_cpu = 60
limit_time_real = 120
limit_time_real_cron = -1
list_db = True
log_db = False
log_db_level = warning
log_handler = :INFO
log_level = info
logrotate = False
longpolling_port = 8072
max_cron_threads = 2
osv_memory_age_limit = 1.0
osv_memory_count_limit = False
pg_path = None
pidfile = False
proxy_mode = True
reportgz = False
server_wide_modules = web
smtp_password = False
smtp_port = 25
smtp_server = localhost
smtp_ssl = False
smtp_user = False
syslog = False
test_commit = False
test_enable = False
test_file = False
test_report_directory = False
translate_modules = ['all']
unaccent = False
without_demo = True
workers = 0
EOF

        </field>
    </record>

    <record id="call_newconfig" model="access_server.command.call">
        <field name="base_command" ref="command_newconfig" />
        <field name="arguments_ids" eval="[
                (5, 0, 0),
                (0, 0, { 'key': 'INSTANCENAME', 'value': 'sidiltestes',  }),
                (0, 0, { 'key': 'BRANCHPATH', 'value': '/odoo/releases/13.0/',  }),
                (0, 0, { 'key': 'ODOO_USERNAME', 'value': 'odoo',  }),
                (0, 0, { 'key': 'HTTPPORT', 'value': '4013',  }),
                ]" />
    </record>

</odoo>
